        -:    0:Source:print_tokens_instrumented.c
        -:    0:Graph:print_tokens_instrumented.gcno
        -:    0:Data:print_tokens_instrumented.gcda
        -:    0:Runs:4130
        -:    1:
        -:    2:
        -:    3:# include <ctype.h>
        -:    4:
        -:    5:# define START  5
        -:    6:# define TRUE  1
        -:    7:# define FALSE 0
        -:    8:
        -:    9:typedef int BOOLEAN;
        -:   10:typedef char *string;
        -:   11:
        -:   12:# include <stdio.h>
        -:   13:# include "tokens.h"
        -:   14:
        -:   15:static token numeric_case();
        -:   16:static token error_or_eof_case();
        -:   17:static int check_delimiter();
        -:   18:static int keyword(int state);
        -:   19:static int special(int state);
        -:   20:static skip(character_stream stream_ptr);
        -:   21:static int constant(int state,char token_str[],int token_ind);
        -:   22:static int next_state();
        -:   23:static get_actual_token(char token_str[],int token_ind);
        -:   24:
        -:   25:#include <stdio.h>
        -:   26:FILE* file_name = NULL;
        -:   27:
        -:   28:
     4130:   29:main(argc,argv)
        -:   30:int argc;
        -:   31:char *argv[];
        -:   32:{   
     4130:   33:    file_name=fopen("v2.txt","a+"); 
     4130:   34:    if(!file_name)
        -:   35:    {	
    #####:   36:        printf("File could not be opened! \n");
    #####:   37:        fclose(file_name);
    #####:   38:        exit(0);
        -:   39:    }
     4130:   40:	fprintf(file_name,"\nP1,");
        -:   41:    token token_ptr;
        -:   42:    token_stream stream_ptr;
        -:   43:
     4130:   44:    if(argc>2)
        -:   45:    {
       30:   46:        fprintf(stdout, "The format is print_tokens filename(optional)\n");
       30:   47:        fprintf(file_name,"P2,");
       30:   48:        fclose(file_name);
       30:   49:        exit(1);
        -:   50:    }
     4100:   51:    fprintf(file_name,"P3,");
     4100:   52:    stream_ptr=open_token_stream(argv[1]);
        -:   53:
    31798:   54:    while(!is_eof_token((token_ptr=get_token(stream_ptr))))
        -:   55:    {
    27728:   56:        fprintf(file_name,"P4,");
    27728:   57:        print_token(token_ptr);
        -:   58:    }
        -:   59:            
     4022:   60:    fprintf(file_name,"P5,");
     4022:   61:    print_token(token_ptr);
     4022:   62:    fclose(file_name);
     4022:   63:    exit(0);
        -:   64:}
        -:   65:
     4100:   66:character_stream open_character_stream(FILENAME)
        -:   67:string FILENAME;
        -:   68:{
     4100:   69:    fprintf(file_name,"P6,");
        -:   70:    character_stream stream_ptr;
        -:   71:
     4100:   72:    stream_ptr=(character_stream)malloc(sizeof(struct stream_type));
     4100:   73:    stream_ptr->stream_ind=START;
     4100:   74:    stream_ptr->stream[START]='\0';
     4100:   75:    if(FILENAME == NULL)
        -:   76:    {
     2963:   77:        fprintf(file_name,"P7,");
     2963:   78:        stream_ptr->fp=stdin;
        -:   79:    }
     1137:   80:    else if((stream_ptr->fp=fopen(FILENAME,"r"))==NULL)
        -:   81:    {
       30:   82:        fprintf(file_name,"P8,");
       30:   83:        fprintf(stdout, "The file %s doesn't exists\n",FILENAME);
       30:   84:        fclose(file_name);
       30:   85:        exit(0);
        -:   86:    }
     4070:   87:    fprintf(file_name,"P9,");
     4070:   88:    return(stream_ptr);
        -:   89:}
        -:   90:
   166045:   91:CHARACTER get_char(stream_ptr)
        -:   92:character_stream stream_ptr;
        -:   93:{
   166045:   94:    if(stream_ptr->stream[stream_ptr->stream_ind] == '\0')
        -:   95:    {
    12513:   96:        fprintf(file_name,"P10,");
    12513:   97:        if(fgets(stream_ptr->stream+START,80-START,stream_ptr->fp) == NULL)/* Fix bug: add -START - hf*/
        -:   98:        {
     4023:   99:            fprintf(file_name,"P11,");
     4023:  100:            stream_ptr->stream[START]=EOF;
        -:  101:        }
    12513:  102:        stream_ptr->stream_ind=START;
        -:  103:    }
   166045:  104:    fprintf(file_name,"P12,");
   166045:  105:    return(stream_ptr->stream[(stream_ptr->stream_ind)++]);
        -:  106:}
        -:  107:
    27451:  108:BOOLEAN is_end_of_character_stream(stream_ptr)
        -:  109:character_stream stream_ptr;
        -:  110:{
    27451:  111:    if(stream_ptr->stream[stream_ptr->stream_ind-1] == EOF){
     4062:  112:        fprintf(file_name,"P13,");
     4062:  113:        return(TRUE);
        -:  114:    }
        -:  115:        
        -:  116:    else{
    23389:  117:        fprintf(file_name,"P14,");
    23389:  118:        return(FALSE);
        -:  119:    }
        -:  120:        
        -:  121:}
        -:  122:
    14144:  123:unget_char(ch,stream_ptr)
        -:  124:CHARACTER ch;
        -:  125:character_stream stream_ptr;
        -:  126:{
    14144:  127:    if(stream_ptr->stream_ind == 0){
    #####:  128:        fprintf(file_name,"P15,");
    #####:  129:        return;
        -:  130:    }
        -:  131:    else{
    14144:  132:        fprintf(file_name,"P16,");
    14144:  133:        stream_ptr->stream[--(stream_ptr->stream_ind)]=ch;
        -:  134:    }
    14144:  135:    fprintf(file_name,"P17,");  
    14144:  136:    return;
        -:  137:}
        -:  138:
     4100:  139:token_stream open_token_stream(FILENAME)
        -:  140:string FILENAME;
        -:  141:{
     4100:  142:    fprintf(file_name,"P18,");  
        -:  143:    token_stream token_ptr;
        -:  144:  
     4100:  145:    token_ptr=(token_stream)malloc(sizeof(struct token_stream_type));
     4100:  146:    token_ptr->ch_stream=open_character_stream(FILENAME);/* Get character
        -:  147:                                                             stream  */
     4070:  148:    return(token_ptr);
        -:  149:}
        -:  150:
    31798:  151:token get_token(tstream_ptr)
        -:  152:token_stream tstream_ptr;
        -:  153:{
    31798:  154:    fprintf(file_name,"P19,");  
        -:  155:    char token_str[80]; /* This buffer stores the current token */
        -:  156:    int token_ind;      /* Index to the token_str  */
        -:  157:    token token_ptr;
        -:  158:    CHARACTER ch;
        -:  159:    int cu_state,next_st,token_found;
        -:  160:
    31798:  161:    token_ptr=(token)(malloc(sizeof(struct token_type)));
    31798:  162:    ch=get_char(tstream_ptr->ch_stream);
    31798:  163:    cu_state=token_ind=token_found=0;
   142946:  164:    while(!token_found)
        -:  165:    {
   142946:  166:        if(token_ind < 80) /* ADDED ERROR CHECK - hf */
        -:  167:        {
   142931:  168:            fprintf(file_name,"P20,");
   142931:  169:            token_str[token_ind++]=ch;
   142931:  170:            next_st=next_state(cu_state,ch);
        -:  171:        }
        -:  172:        else
        -:  173:        {
       15:  174:            fprintf(file_name,"P21,");
       15:  175:            next_st = -1; /* - hf */
        -:  176:        }
   142946:  177:        if (next_st == -1) 
        -:  178:        {
    10721:  179:            fprintf(file_name,"P22,");
    31750:  180:            return(error_or_eof_case(tstream_ptr, token_ptr,cu_state,token_str,token_ind,ch));
   132225:  181:        } else if (next_st == -2) 
        -:  182:        {
     2449:  183:            fprintf(file_name,"P23,");
     2449:  184:            return(numeric_case(tstream_ptr,token_ptr,ch, token_str,token_ind));
   129776:  185:        } else if (next_st == -3) 
        -:  186:        {
     8090:  187:            fprintf(file_name,"P24,");
     8090:  188:            token_ptr->token_id=IDENTIFIER;
     8090:  189:            unget_char(ch,tstream_ptr->ch_stream);
     8090:  190:            token_ind--;
     8090:  191:            get_actual_token(token_str,token_ind);
     8090:  192:            strcpy(token_ptr->token_string,token_str);
     8090:  193:            return(token_ptr);
        -:  194:        } 
        -:  195:        
   121686:  196:        switch(next_st) 
        -:  197:        { 
   108761:  198:            default : fprintf(file_name,"P25,"); break;
     2283:  199:            case 6  : /* These are all KEYWORD cases. */
        -:  200:            case 9  :
        -:  201:            case 11 :
        -:  202:            case 13 :
     2283:  203:		    case 12 : fprintf(file_name,"P111,");
     2722:  204:            case 16 : fprintf(file_name,"P26,");
     2722:  205:                    ch=get_char(tstream_ptr->ch_stream);
     2722:  206:                    if(check_delimiter(ch)==TRUE)
        -:  207:                    {
     2176:  208:                        fprintf(file_name,"P27,");
     2176:  209:                        token_ptr->token_id=keyword(next_st);
     2128:  210:                        unget_char(ch,tstream_ptr->ch_stream);
     2128:  211:                        token_ptr->token_string[0]='\0';
     2128:  212:                        return(token_ptr);
        -:  213:                    }
      546:  214:                    fprintf(file_name,"P28,");
      546:  215:                    unget_char(ch,tstream_ptr->ch_stream);
      546:  216:                    break;
     4873:  217:            case 19 : /* These are all special SPECIAL character */
        -:  218:            case 20 : /* cases */
        -:  219:            case 21 :
        -:  220:            case 22 :
        -:  221:            case 23 :
        -:  222:            case 24 :
        -:  223:            case 25 :
     4873:  224:            case 32 : fprintf(file_name,"P29,");
     4873:  225:                    token_ptr->token_id=special(next_st);
     4873:  226:                    token_ptr->token_string[0]='\0';
     4873:  227:                    return(token_ptr);
     3489:  228:            case 27 : /* These are constant cases */
     3489:  229:            case 29 :fprintf(file_name,"P30,");
     3489:  230:                    token_ptr->token_id=constant(next_st,token_str,token_ind);
     3489:  231:                    get_actual_token(token_str,token_ind);
     3489:  232:                    strcpy(token_ptr->token_string,token_str);
     3489:  233:                    return(token_ptr);
     1841:  234:            case 30 :  /* This is COMMENT case */
     1841:  235:                    fprintf(file_name,"P31,");
     1841:  236:                    skip(tstream_ptr->ch_stream);
     1841:  237:                    token_ind=next_st=0;
     1841:  238:                    break;
        -:  239:        }
   111148:  240:        fprintf(file_name,"P32,");
   111148:  241:        cu_state=next_st;
   111148:  242:        ch=get_char(tstream_ptr->ch_stream);
        -:  243:    }
    #####:  244:}
        -:  245:
     2449:  246:static token numeric_case(tstream_ptr,token_ptr,ch,token_str,token_ind)
        -:  247:token_stream tstream_ptr;
        -:  248:token token_ptr;
        -:  249:char ch,token_str[];
        -:  250:int token_ind;
        -:  251:{
     2449:  252:    if(check_delimiter(ch)!=TRUE)
        -:  253:    {   /* Error case */
      586:  254:        fprintf(file_name,"P33,");
      586:  255:        token_ptr->token_id=ERROR;
     2432:  256:        while(check_delimiter(ch)==FALSE)
        -:  257:        {
     1846:  258:            if(token_ind >= 80)
        -:  259:            {
    #####:  260:                fprintf(file_name,"P34,");
    #####:  261:                break;
        -:  262:            }
     1846:  263:            fprintf(file_name,"P35,");  
     1846:  264:            token_str[token_ind++]=ch=get_char(tstream_ptr->ch_stream);
        -:  265:        }
      586:  266:        fprintf(file_name,"P36,");
      586:  267:        unget_char(ch,tstream_ptr->ch_stream);
      586:  268:        token_ind--;
      586:  269:        get_actual_token(token_str,token_ind);
      586:  270:        strcpy(token_ptr->token_string,token_str);
      586:  271:        return(token_ptr);
        -:  272:    }
     1863:  273:    fprintf(file_name,"P37,");
     1863:  274:    token_ptr->token_id=NUMERIC; /* Numeric case */
     1863:  275:    unget_char(ch,tstream_ptr->ch_stream);
     1863:  276:    token_ind--;
     1863:  277:    get_actual_token(token_str,token_ind);
     1863:  278:    strcpy(token_ptr->token_string,token_str);
     1863:  279:    return(token_ptr);
        -:  280:}
        -:  281:
    10721:  282:static token error_or_eof_case(tstream_ptr,token_ptr,cu_state,token_str,token_ind,ch)
        -:  283:token_stream tstream_ptr;
        -:  284:token token_ptr;
        -:  285:int cu_state,token_ind;
        -:  286:char token_str[],ch;
        -:  287:{
        -:  288:    
    10721:  289:    if(is_end_of_character_stream(tstream_ptr->ch_stream)) 
        -:  290:    {
     4022:  291:        fprintf(file_name,"P38,");
     4022:  292:        token_ptr->token_id = EOTSTREAM;
     4022:  293:        token_ptr->token_string[0]='\0';
     4022:  294:        return(token_ptr);
        -:  295:    }
     6699:  296:    if(cu_state !=0)
        -:  297:    {
      891:  298:        fprintf(file_name,"P39,");
      891:  299:        unget_char(ch,tstream_ptr->ch_stream);
      891:  300:        token_ind--;
        -:  301:    }
     6699:  302:    fprintf(file_name,"P40,");
     6699:  303:    token_ptr->token_id=ERROR;
     6699:  304:    get_actual_token(token_str,token_ind);
     6699:  305:    strcpy(token_ptr->token_string,token_str);
     6699:  306:    return(token_ptr);                
        -:  307:}
        -:  308:
     7603:  309:static int check_delimiter(ch)
        -:  310:char ch;
        -:  311:{
     7603:  312:    if(!isalpha(ch) && !isdigit(ch))
        -:  313:    {
     4625:  314:        fprintf(file_name,"P41,");
     4625:  315:        return(TRUE);
        -:  316:    }
     2978:  317:    fprintf(file_name,"P42,");
     2978:  318:    return(FALSE);
        -:  319:}
        -:  320:
     2176:  321:static int keyword(state)
        -:  322:int state;
        -:  323:{
     2176:  324:    switch(state)
        -:  325:    {   /* Return the respective macro for the Keyword. */
      445:  326:        case 6 : fprintf(file_name,"P43,"); return(LAMBDA);
      440:  327:        case 9 : fprintf(file_name,"P44,"); return(AND);
      417:  328:        case 11: fprintf(file_name,"P45,"); return(OR);
      396:  329:        case 13: fprintf(file_name,"P46,"); return(IF);
      430:  330:        case 16: fprintf(file_name,"P47,"); return(XOR);
       48:  331:        default: fprintf(file_name,"P48,"); fprintf(stdout, "error\n");break;
        -:  332:    }
       48:  333:    fprintf(file_name,"P49,");
       48:  334:    fclose(file_name);
       48:  335:    exit(0);
        -:  336:}
        -:  337:
     4873:  338:static int special(state)
        -:  339:int state;
        -:  340:{
     4873:  341:    switch(state)
        -:  342:    {   /* return the respective macro for the special character. */
      590:  343:        case 19: fprintf(file_name,"P50,"); return(LPAREN);
      633:  344:        case 20: fprintf(file_name,"P51,"); return(RPAREN);
      624:  345:        case 21: fprintf(file_name,"P52,"); return(LSQUARE);
      650:  346:        case 22: fprintf(file_name,"P53,"); return(RSQUARE);
      643:  347:        case 23: fprintf(file_name,"P54,"); return(QUOTE);
      630:  348:        case 24: fprintf(file_name,"P55,"); return(BQUOTE);
      614:  349:        case 25: fprintf(file_name,"P56,"); return(COMMA);
      489:  350:        case 32: fprintf(file_name,"P57,"); return(EQUALGREATER);
    #####:  351:        default: fprintf(file_name,"P58,");fprintf(stdout, "error\n");break;
        -:  352:    }
    #####:  353:    fprintf(file_name,"P59,");
    #####:  354:    fclose(file_name);
    #####:  355:    exit(0);
        -:  356:}
        -:  357:
     1841:  358:static skip(stream_ptr)
        -:  359:character_stream stream_ptr;
        -:  360:{
        -:  361:    char c;
    18531:  362:    while((c=get_char(stream_ptr))!='\n' && !is_end_of_character_stream(stream_ptr)) /* Skip the characters until EOF or EOL found. */
        -:  363:    {
    16690:  364:        fprintf(file_name,"P60,");
        -:  365:    }
     1841:  366:	if(c==EOF){
       40:  367:        fprintf(file_name,"P61,");
       40:  368:        unget_char(c, stream_ptr); /* Put back to leave gracefully - hf */
        -:  369:    }
     1841:  370:    fprintf(file_name,"P62,");
     1841:  371:    return;
        -:  372:}
        -:  373:
     3489:  374:static int constant(state,token_str,token_ind)
        -:  375:int state,token_ind;
        -:  376:char token_str[];
        -:  377:{
     3489:  378:    switch(state)
        -:  379:    {   /* Return the respective CONSTANT macro. */
     1654:  380:        case 27 : fprintf(file_name,"P63,"); return(STRING_CONSTANT);
     1835:  381:        case 29 : fprintf(file_name,"P64,"); token_str[token_ind-2]=' '; return(CHARACTER_CONSTANT);
    #####:  382:        default : fprintf(file_name,"P65,"); break;
        -:  383:    }
    #####:  384:}
        -:  385:              
   223588:  386:static int next_state(state,ch)
        -:  387:int state;
        -:  388:char ch;
        -:  389:{
   223588:  390:    if(state < 0)
        -:  391:    {
    21245:  392:        fprintf(file_name,"P66,");
    21245:  393:        return(state);
        -:  394:    }
        -:  395:      
   202343:  396:    if(base[state]+ch >= 0)
        -:  397:    {
   191702:  398:        if(check[base[state]+ch] == state) /* Check for the right state */
        -:  399:        {
   121686:  400:            fprintf(file_name,"P67,");
   121686:  401:            return(next[base[state]+ch]);
        -:  402:        }   
        -:  403:        else
        -:  404:        {
    70016:  405:            fprintf(file_name,"P68,");
    70016:  406:            return(next_state(default1[state],ch));
        -:  407:        }
        -:  408:    }
        -:  409:    else
        -:  410:    {
    10641:  411:        fprintf(file_name,"P69,");
    10641:  412:        return(next_state(default1[state],ch));
        -:  413:    }
        -:  414:}
        -:  415:
    31750:  416:BOOLEAN is_eof_token(t)
        -:  417:token t;
        -:  418:{
    31750:  419:    if(t->token_id==EOTSTREAM)
        -:  420:    {
     4022:  421:        fprintf(file_name,"P70,");
     4022:  422:        return(TRUE);
        -:  423:    }
    27728:  424:    fprintf(file_name,"P71,");    
    27728:  425:    return(FALSE);
        -:  426:}
        -:  427:
    31750:  428:BOOLEAN print_token(token_ptr)
        -:  429:token token_ptr;
        -:  430:{
    31750:  431:     switch(token_ptr->token_id)
        -:  432:     {    /* Print the respective tokens. */
     7285:  433:          case ERROR : fprintf(file_name,"P72,"); fprintf(stdout, "error,\t\"");fprintf(stdout, "%s",token_ptr->token_string);
     7285:  434:                       fprintf(stdout, "\".\n");return(TRUE);
     4022:  435:          case EOTSTREAM : fprintf(file_name,"P73,"); fprintf(stdout, "eof.\n");return(TRUE);
      445:  436:          case 6 : fprintf(file_name,"P74,"); fprintf(stdout, "keyword,\t\"lambda\".\n");return(TRUE);
      440:  437:          case 9 : fprintf(file_name,"P75,"); fprintf(stdout, "keyword,\t\"and\".\n");return(TRUE);
      417:  438:          case 11: fprintf(file_name,"P76,"); fprintf(stdout, "keyword,\t\"or\".\n");return(TRUE);
      396:  439:          case 13: fprintf(file_name,"P78,"); fprintf(stdout, "keyword,\t\"if\".\n");return(TRUE);
      430:  440:          case 16: fprintf(file_name,"P79,"); fprintf(stdout, "keyword,\t\"xor\".\n");return(TRUE);
     8090:  441:          case 17: fprintf(file_name,"P80,"); fprintf(stdout, "identifier,\t\"");fprintf(stdout, "%s",token_ptr->token_string);
     8090:  442:                   fprintf(stdout, "\".\n");return(TRUE);
     1863:  443:          case 18: fprintf(file_name,"P81,"); fprintf(stdout, "numeric,\t");fprintf(stdout, "%s",token_ptr->token_string);
     1863:  444:                   fprintf(stdout, ".\n");return(TRUE);
      590:  445:          case 19: fprintf(file_name,"P82,"); fprintf(stdout, "lparen.\n");return(TRUE);
      633:  446:          case 20: fprintf(file_name,"P83,"); fprintf(stdout, "rparen.\n");return(TRUE);
      624:  447:          case 21: fprintf(file_name,"P84,"); fprintf(stdout, "lsquare.\n");return(TRUE);
      650:  448:          case 22: fprintf(file_name,"P85,"); fprintf(stdout, "rsquare.\n");return(TRUE);
      643:  449:          case 23: fprintf(file_name,"P86,"); fprintf(stdout, "quote.\n");return(TRUE);
      630:  450:          case 24: fprintf(file_name,"P87,"); fprintf(stdout, "bquote.\n");return(TRUE);
      614:  451:          case 25: fprintf(file_name,"P88,"); fprintf(stdout, "comma.\n");return(TRUE);
     1654:  452:          case 27: fprintf(file_name,"P89,"); fprintf(stdout, "string,\t");fprintf(stdout, "%s",token_ptr->token_string);
     1654:  453:                   fprintf(stdout, ".\n");return(TRUE);
     1835:  454:          case 29: fprintf(file_name,"P90,"); fprintf(stdout, "character,\t\"");fprintf(stdout, "%s",token_ptr->token_string);
     1835:  455:                   fprintf(stdout, "\".\n");return(TRUE);
      489:  456:          case 32: fprintf(file_name,"P91,"); fprintf(stdout, "keyword,\t\"=>\".\n");return(TRUE);
    #####:  457:          default: fprintf(file_name,"P92,");break;
        -:  458:      }
    #####:  459:      fprintf(file_name,"P93,");
    #####:  460:      return(FALSE);
        -:  461:}
        -:  462:
    20727:  463:static get_actual_token(token_str,token_ind)
        -:  464:int token_ind;
        -:  465:char token_str[];
        -:  466:{
    20727:  467:    fprintf(file_name,"P94,");
        -:  468:    int ind,start;
    21583:  469:    for(ind=token_ind;ind>0 && isspace(token_str[ind-1]);--ind){
      856:  470:        fprintf(file_name,"P95,");
        -:  471:    }
    20727:  472:    fprintf(file_name,"P96,");
    20727:  473:    token_str[ind]='\0';token_ind=ind;
    34472:  474:    for(ind=0;ind<token_ind;++ind)
        -:  475:    {
    34439:  476:        fprintf(file_name,"P97,");
    34439:  477:        if(!isspace(token_str[ind]))
        -:  478:        {
    20694:  479:            fprintf(file_name,"P98,");
    20694:  480:            break;
        -:  481:        }
        -:  482:    }
        -:  483:        
        -:  484:                
   119040:  485:    for(start=0;ind<=token_ind;++start,++ind)
        -:  486:    {
    98313:  487:        fprintf(file_name,"P99,");
    98313:  488:        token_str[start]=token_str[ind];
        -:  489:    }
    20727:  490:    fprintf(file_name,"P100,");
    20727:  491:    return;
        -:  492:}
