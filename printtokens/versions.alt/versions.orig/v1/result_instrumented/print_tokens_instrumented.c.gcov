        -:    0:Source:print_tokens_instrumented.c
        -:    0:Graph:print_tokens_instrumented.gcno
        -:    0:Data:print_tokens_instrumented.gcda
        -:    0:Runs:4130
        -:    1:
        -:    2:
        -:    3:# include <ctype.h>
        -:    4:
        -:    5:# define START  5
        -:    6:# define TRUE  1
        -:    7:# define FALSE 0
        -:    8:
        -:    9:typedef int BOOLEAN;
        -:   10:typedef char *string;
        -:   11:
        -:   12:# include <stdio.h>
        -:   13:# include "tokens.h"
        -:   14:
        -:   15:static token numeric_case();
        -:   16:static token error_or_eof_case();
        -:   17:static int check_delimiter();
        -:   18:static int keyword(int state);
        -:   19:static int special(int state);
        -:   20:static skip(character_stream stream_ptr);
        -:   21:static int constant(int state,char token_str[],int token_ind);
        -:   22:static int next_state();
        -:   23:static get_actual_token(char token_str[],int token_ind);
        -:   24:
        -:   25:#include <stdio.h>
        -:   26:FILE* file_name = NULL;
        -:   27:
        -:   28:
     4130:   29:main(argc,argv)
        -:   30:int argc;
        -:   31:char *argv[];
        -:   32:{   
     4130:   33:    file_name=fopen("v1.txt","a+"); 
     4130:   34:    if(!file_name)
        -:   35:    {	
    #####:   36:        printf("File could not be opened! \n");
    #####:   37:        fclose(file_name);
    #####:   38:        exit(0);
        -:   39:    }
     4130:   40:	fprintf(file_name,"\nP1,");
        -:   41:    token token_ptr;
        -:   42:    token_stream stream_ptr;
        -:   43:
     4130:   44:    if(argc>2)
        -:   45:    {
       30:   46:        fprintf(stdout, "The format is print_tokens filename(optional)\n");
       30:   47:        fprintf(file_name,"P2,");
       30:   48:        fclose(file_name);
       30:   49:        exit(1);
        -:   50:    }
     4100:   51:    fprintf(file_name,"P3,");
     4100:   52:    stream_ptr=open_token_stream(argv[1]);
        -:   53:
    28946:   54:    while(!is_eof_token((token_ptr=get_token(stream_ptr))))
        -:   55:    {
    24876:   56:        fprintf(file_name,"P4,");
    24876:   57:        print_token(token_ptr);
        -:   58:    }
        -:   59:            
     3645:   60:    fprintf(file_name,"P5,");
     3645:   61:    print_token(token_ptr);
     3645:   62:    fclose(file_name);
     3645:   63:    exit(0);
        -:   64:}
        -:   65:
     4100:   66:character_stream open_character_stream(FILENAME)
        -:   67:string FILENAME;
        -:   68:{
     4100:   69:    fprintf(file_name,"P6,");
        -:   70:    character_stream stream_ptr;
        -:   71:
     4100:   72:    stream_ptr=(character_stream)malloc(sizeof(struct stream_type));
     4100:   73:    stream_ptr->stream_ind=START;
     4100:   74:    stream_ptr->stream[START]='\0';
     4100:   75:    if(FILENAME == NULL)
        -:   76:    {
     2963:   77:        fprintf(file_name,"P7,");
     2963:   78:        stream_ptr->fp=stdin;
        -:   79:    }
     1137:   80:    else if((stream_ptr->fp=fopen(FILENAME,"r"))==NULL)
        -:   81:    {
       30:   82:        fprintf(file_name,"P8,");
       30:   83:        fprintf(stdout, "The file %s doesn't exists\n",FILENAME);
       30:   84:        fclose(file_name);
       30:   85:        exit(0);
        -:   86:    }
     4070:   87:    fprintf(file_name,"P9,");
     4070:   88:    return(stream_ptr);
        -:   89:}
        -:   90:
   139282:   91:CHARACTER get_char(stream_ptr)
        -:   92:character_stream stream_ptr;
        -:   93:{
   139282:   94:    if(stream_ptr->stream[stream_ptr->stream_ind] == '\0')
        -:   95:    {
    11232:   96:        fprintf(file_name,"P10,");
    11232:   97:        if(fgets(stream_ptr->stream+START,80-START,stream_ptr->fp) == NULL)/* Fix bug: add -START - hf*/
        -:   98:        {
     3645:   99:            fprintf(file_name,"P11,");
     3645:  100:            stream_ptr->stream[START]=EOF;
        -:  101:        }
    11232:  102:        stream_ptr->stream_ind=START;
        -:  103:    }
   139282:  104:    fprintf(file_name,"P12,");
   139282:  105:    return(stream_ptr->stream[(stream_ptr->stream_ind)++]);
        -:  106:}
        -:  107:
    23944:  108:BOOLEAN is_end_of_character_stream(stream_ptr)
        -:  109:character_stream stream_ptr;
        -:  110:{
    23944:  111:    if(stream_ptr->stream[stream_ptr->stream_ind-1] == EOF){
     3682:  112:        fprintf(file_name,"P13,");
     3682:  113:        return(TRUE);
        -:  114:    }
        -:  115:        
        -:  116:    else{
    20262:  117:        fprintf(file_name,"P14,");
    20262:  118:        return(FALSE);
        -:  119:    }
        -:  120:        
        -:  121:}
        -:  122:
    12392:  123:unget_char(ch,stream_ptr)
        -:  124:CHARACTER ch;
        -:  125:character_stream stream_ptr;
        -:  126:{
    12392:  127:    if(stream_ptr->stream_ind == 0){
    #####:  128:        fprintf(file_name,"P15,");
    #####:  129:        return;
        -:  130:    }
        -:  131:    else{
    12392:  132:        fprintf(file_name,"P16,");
    12392:  133:        stream_ptr->stream[--(stream_ptr->stream_ind)]=ch;
        -:  134:    }
    12392:  135:    fprintf(file_name,"P17,");  
    12392:  136:    return;
        -:  137:}
        -:  138:
     4100:  139:token_stream open_token_stream(FILENAME)
        -:  140:string FILENAME;
        -:  141:{
     4100:  142:    fprintf(file_name,"P18,");  
        -:  143:    token_stream token_ptr;
        -:  144:  
     4100:  145:    token_ptr=(token_stream)malloc(sizeof(struct token_stream_type));
     4100:  146:    token_ptr->ch_stream=open_character_stream(FILENAME);/* Get character
        -:  147:                                                             stream  */
     4070:  148:    return(token_ptr);
        -:  149:}
        -:  150:
    28946:  151:token get_token(tstream_ptr)
        -:  152:token_stream tstream_ptr;
        -:  153:{
    28946:  154:    fprintf(file_name,"P19,");  
        -:  155:    char token_str[80]; /* This buffer stores the current token */
        -:  156:    int token_ind;      /* Index to the token_str  */
        -:  157:    token token_ptr;
        -:  158:    CHARACTER ch;
        -:  159:    int cu_state,next_st,token_found;
        -:  160:
    28946:  161:    token_ptr=(token)(malloc(sizeof(struct token_type)));
    28946:  162:    ch=get_char(tstream_ptr->ch_stream);
    28946:  163:    cu_state=token_ind=token_found=0;
   120304:  164:    while(!token_found)
        -:  165:    {
   120304:  166:        if(token_ind < 80) /* ADDED ERROR CHECK - hf */
        -:  167:        {
   120285:  168:            fprintf(file_name,"P20,");
   120285:  169:            token_str[token_ind++]=ch;
   120285:  170:            next_st=next_state(cu_state,ch);
        -:  171:        }
        -:  172:        else
        -:  173:        {
       19:  174:            fprintf(file_name,"P21,");
       19:  175:            next_st = -1; /* - hf */
        -:  176:        }
   120304:  177:        if (next_st == -1) 
        -:  178:        {
    10019:  179:            fprintf(file_name,"P22,");
    28521:  180:            return(error_or_eof_case(tstream_ptr, token_ptr,cu_state,token_str,token_ind,ch));
   110285:  181:        } else if (next_st == -2) 
        -:  182:        {
     2169:  183:            fprintf(file_name,"P23,");
     2169:  184:            return(numeric_case(tstream_ptr,token_ptr,ch, token_str,token_ind));
   108116:  185:        } else if (next_st == -3) 
        -:  186:        {
     7446:  187:            fprintf(file_name,"P24,");
     7446:  188:            token_ptr->token_id=IDENTIFIER;
     7446:  189:            unget_char(ch,tstream_ptr->ch_stream);
     7446:  190:            token_ind--;
     7446:  191:            get_actual_token(token_str,token_ind);
     7446:  192:            strcpy(token_ptr->token_string,token_str);
     7446:  193:            return(token_ptr);
        -:  194:        } 
        -:  195:        
   100670:  196:        switch(next_st) 
        -:  197:        { 
    89851:  198:            default : fprintf(file_name,"P25,"); break;
     1892:  199:            case 6  : /* These are all KEYWORD cases. */
        -:  200:            case 9  :
        -:  201:            case 11 :
        -:  202:            case 13 :
     1892:  203:            case 16 : fprintf(file_name,"P26,");
     1892:  204:                    ch=get_char(tstream_ptr->ch_stream);
     1892:  205:                    if(check_delimiter(ch)==TRUE)
        -:  206:                    {
     1857:  207:                        fprintf(file_name,"P27,");
     1857:  208:                        token_ptr->token_id=keyword(next_st);
     1857:  209:                        unget_char(ch,tstream_ptr->ch_stream);
     1857:  210:                        token_ptr->token_string[0]='\0';
     1857:  211:                        return(token_ptr);
        -:  212:                    }
       35:  213:                    fprintf(file_name,"P28,");
       35:  214:                    unget_char(ch,tstream_ptr->ch_stream);
       35:  215:                    break;
     4290:  216:            case 19 : /* These are all special SPECIAL character */
        -:  217:            case 20 : /* cases */
        -:  218:            case 21 :
        -:  219:            case 22 :
        -:  220:            case 23 :
        -:  221:            case 24 :
        -:  222:            case 25 :
     4290:  223:            case 32 : fprintf(file_name,"P29,");
     4290:  224:                    token_ptr->token_id=special(next_st);
     3865:  225:                    token_ptr->token_string[0]='\0';
     3865:  226:                    return(token_ptr);
     3165:  227:            case 27 : /* These are constant cases */
     3165:  228:            case 29 :fprintf(file_name,"P30,");
     3165:  229:                    token_ptr->token_id=constant(next_st,token_str,token_ind);
     3165:  230:                    get_actual_token(token_str,token_ind);
     3165:  231:                    strcpy(token_ptr->token_string,token_str);
     3165:  232:                    return(token_ptr);
     1472:  233:            case 30 :  /* This is COMMENT case */
     1472:  234:                    fprintf(file_name,"P31,");
     1472:  235:                    skip(tstream_ptr->ch_stream);
     1472:  236:                    token_ind=next_st=0;
     1472:  237:                    break;
        -:  238:        }
    91358:  239:        fprintf(file_name,"P32,");
    91358:  240:        cu_state=next_st;
    91358:  241:        ch=get_char(tstream_ptr->ch_stream);
        -:  242:    }
    #####:  243:}
        -:  244:
     2169:  245:static token numeric_case(tstream_ptr,token_ptr,ch,token_str,token_ind)
        -:  246:token_stream tstream_ptr;
        -:  247:token token_ptr;
        -:  248:char ch,token_str[];
        -:  249:int token_ind;
        -:  250:{
     2169:  251:    if(check_delimiter(ch)!=TRUE)
        -:  252:    {   /* Error case */
      545:  253:        fprintf(file_name,"P33,");
      545:  254:        token_ptr->token_id=ERROR;
     2271:  255:        while(check_delimiter(ch)==FALSE)
        -:  256:        {
     1726:  257:            if(token_ind >= 80)
        -:  258:            {
    #####:  259:                fprintf(file_name,"P34,");
    #####:  260:                break;
        -:  261:            }
     1726:  262:            fprintf(file_name,"P35,");  
     1726:  263:            token_str[token_ind++]=ch=get_char(tstream_ptr->ch_stream);
        -:  264:        }
      545:  265:        fprintf(file_name,"P36,");
      545:  266:        unget_char(ch,tstream_ptr->ch_stream);
      545:  267:        token_ind--;
      545:  268:        get_actual_token(token_str,token_ind);
      545:  269:        strcpy(token_ptr->token_string,token_str);
      545:  270:        return(token_ptr);
        -:  271:    }
     1624:  272:    fprintf(file_name,"P37,");
     1624:  273:    token_ptr->token_id=NUMERIC; /* Numeric case */
     1624:  274:    unget_char(ch,tstream_ptr->ch_stream);
     1624:  275:    token_ind--;
     1624:  276:    get_actual_token(token_str,token_ind);
     1624:  277:    strcpy(token_ptr->token_string,token_str);
     1624:  278:    return(token_ptr);
        -:  279:}
        -:  280:
    10019:  281:static token error_or_eof_case(tstream_ptr,token_ptr,cu_state,token_str,token_ind,ch)
        -:  282:token_stream tstream_ptr;
        -:  283:token token_ptr;
        -:  284:int cu_state,token_ind;
        -:  285:char token_str[],ch;
        -:  286:{
        -:  287:    
    10019:  288:    if(is_end_of_character_stream(tstream_ptr->ch_stream)) 
        -:  289:    {
     3645:  290:        fprintf(file_name,"P38,");
     3645:  291:        token_ptr->token_id = EOTSTREAM;
     3645:  292:        token_ptr->token_string[0]='\0';
     3645:  293:        return(token_ptr);
        -:  294:    }
     6374:  295:    if(cu_state !=0)
        -:  296:    {
      848:  297:        fprintf(file_name,"P39,");
      848:  298:        unget_char(ch,tstream_ptr->ch_stream);
      848:  299:        token_ind--;
        -:  300:    }
     6374:  301:    fprintf(file_name,"P40,");
     6374:  302:    token_ptr->token_id=ERROR;
     6374:  303:    get_actual_token(token_str,token_ind);
     6374:  304:    strcpy(token_ptr->token_string,token_str);
     6374:  305:    return(token_ptr);                
        -:  306:}
        -:  307:
     6332:  308:static int check_delimiter(ch)
        -:  309:char ch;
        -:  310:{
     6332:  311:    if(!isalpha(ch) && !isdigit(ch))
        -:  312:    {
     4026:  313:        fprintf(file_name,"P41,");
     4026:  314:        return(TRUE);
        -:  315:    }
     2306:  316:    fprintf(file_name,"P42,");
     2306:  317:    return(FALSE);
        -:  318:}
        -:  319:
     1857:  320:static int keyword(state)
        -:  321:int state;
        -:  322:{
     1857:  323:    switch(state)
        -:  324:    {   /* Return the respective macro for the Keyword. */
      390:  325:        case 6 : fprintf(file_name,"P43,"); return(LAMBDA);
      388:  326:        case 9 : fprintf(file_name,"P44,"); return(AND);
      368:  327:        case 11: fprintf(file_name,"P45,"); return(OR);
      329:  328:        case 13: fprintf(file_name,"P46,"); return(IF);
      382:  329:        case 16: fprintf(file_name,"P47,"); return(XOR);
    #####:  330:        case 32: fprintf(file_name,"P111,"); return(EQUALGREATER);
    #####:  331:        default: fprintf(file_name,"P48,"); fprintf(stdout, "error\n");break;
        -:  332:    }
    #####:  333:    fprintf(file_name,"P49,");
    #####:  334:    fclose(file_name);
    #####:  335:    exit(0);
        -:  336:}
        -:  337:
     4290:  338:static int special(state)
        -:  339:int state;
        -:  340:{
     4290:  341:    switch(state)
        -:  342:    {   /* return the respective macro for the special character. */
      525:  343:        case 19: fprintf(file_name,"P50,"); return(LPAREN);
      554:  344:        case 20: fprintf(file_name,"P51,"); return(RPAREN);
      540:  345:        case 21: fprintf(file_name,"P52,"); return(LSQUARE);
      582:  346:        case 22: fprintf(file_name,"P53,"); return(RSQUARE);
      569:  347:        case 23: fprintf(file_name,"P54,"); return(QUOTE);
      558:  348:        case 24: fprintf(file_name,"P55,"); return(BQUOTE);
      537:  349:        case 25: fprintf(file_name,"P56,"); return(COMMA);
      425:  350:        default: fprintf(file_name,"P58,");fprintf(stdout, "error\n");break;
        -:  351:    }
      425:  352:    fprintf(file_name,"P59,");
      425:  353:    fclose(file_name);
      425:  354:    exit(0);
        -:  355:}
        -:  356:
     1472:  357:static skip(stream_ptr)
        -:  358:character_stream stream_ptr;
        -:  359:{
        -:  360:    char c;
    15360:  361:    while((c=get_char(stream_ptr))!='\n' && !is_end_of_character_stream(stream_ptr)) /* Skip the characters until EOF or EOL found. */
        -:  362:    {
    13888:  363:        fprintf(file_name,"P60,");
        -:  364:    }
     1472:  365:	if(c==EOF){
       37:  366:        fprintf(file_name,"P61,");
       37:  367:        unget_char(c, stream_ptr); /* Put back to leave gracefully - hf */
        -:  368:    }
     1472:  369:    fprintf(file_name,"P62,");
     1472:  370:    return;
        -:  371:}
        -:  372:
     3165:  373:static int constant(state,token_str,token_ind)
        -:  374:int state,token_ind;
        -:  375:char token_str[];
        -:  376:{
     3165:  377:    switch(state)
        -:  378:    {   /* Return the respective CONSTANT macro. */
     1496:  379:        case 27 : fprintf(file_name,"P63,"); return(STRING_CONSTANT);
     1669:  380:        case 29 : fprintf(file_name,"P64,"); token_str[token_ind-2]=' '; return(CHARACTER_CONSTANT);
    #####:  381:        default : fprintf(file_name,"P65,"); break;
        -:  382:    }
    #####:  383:}
        -:  384:              
   194283:  385:static int next_state(state,ch)
        -:  386:int state;
        -:  387:char ch;
        -:  388:{
   194283:  389:    if(state < 0)
        -:  390:    {
    19615:  391:        fprintf(file_name,"P66,");
    19615:  392:        return(state);
        -:  393:    }
        -:  394:      
   174668:  395:    if(base[state]+ch >= 0)
        -:  396:    {
   165253:  397:        if(check[base[state]+ch] == state) /* Check for the right state */
        -:  398:        {
   100670:  399:            fprintf(file_name,"P67,");
   100670:  400:            return(next[base[state]+ch]);
        -:  401:        }   
        -:  402:        else
        -:  403:        {
    64583:  404:            fprintf(file_name,"P68,");
    64583:  405:            return(next_state(default1[state],ch));
        -:  406:        }
        -:  407:    }
        -:  408:    else
        -:  409:    {
     9415:  410:        fprintf(file_name,"P69,");
     9415:  411:        return(next_state(default1[state],ch));
        -:  412:    }
        -:  413:}
        -:  414:
    28521:  415:BOOLEAN is_eof_token(t)
        -:  416:token t;
        -:  417:{
    28521:  418:    if(t->token_id==EOTSTREAM)
        -:  419:    {
     3645:  420:        fprintf(file_name,"P70,");
     3645:  421:        return(TRUE);
        -:  422:    }
    24876:  423:    fprintf(file_name,"P71,");    
    24876:  424:    return(FALSE);
        -:  425:}
        -:  426:
    28521:  427:BOOLEAN print_token(token_ptr)
        -:  428:token token_ptr;
        -:  429:{
    28521:  430:     switch(token_ptr->token_id)
        -:  431:     {    /* Print the respective tokens. */
     6919:  432:          case ERROR : fprintf(file_name,"P72,"); fprintf(stdout, "error,\t\"");fprintf(stdout, "%s",token_ptr->token_string);
     6919:  433:                       fprintf(stdout, "\".\n");return(TRUE);
     3645:  434:          case EOTSTREAM : fprintf(file_name,"P73,"); fprintf(stdout, "eof.\n");return(TRUE);
      390:  435:          case 6 : fprintf(file_name,"P74,"); fprintf(stdout, "keyword,\t\"lambda\".\n");return(TRUE);
      388:  436:          case 9 : fprintf(file_name,"P75,"); fprintf(stdout, "keyword,\t\"and\".\n");return(TRUE);
      368:  437:          case 11: fprintf(file_name,"P76,"); fprintf(stdout, "keyword,\t\"or\".\n");return(TRUE);
      329:  438:          case 13: fprintf(file_name,"P78,"); fprintf(stdout, "keyword,\t\"if\".\n");return(TRUE);
      382:  439:          case 16: fprintf(file_name,"P79,"); fprintf(stdout, "keyword,\t\"xor\".\n");return(TRUE);
     7446:  440:          case 17: fprintf(file_name,"P80,"); fprintf(stdout, "identifier,\t\"");fprintf(stdout, "%s",token_ptr->token_string);
     7446:  441:                   fprintf(stdout, "\".\n");return(TRUE);
     1624:  442:          case 18: fprintf(file_name,"P81,"); fprintf(stdout, "numeric,\t");fprintf(stdout, "%s",token_ptr->token_string);
     1624:  443:                   fprintf(stdout, ".\n");return(TRUE);
      525:  444:          case 19: fprintf(file_name,"P82,"); fprintf(stdout, "lparen.\n");return(TRUE);
      554:  445:          case 20: fprintf(file_name,"P83,"); fprintf(stdout, "rparen.\n");return(TRUE);
      540:  446:          case 21: fprintf(file_name,"P84,"); fprintf(stdout, "lsquare.\n");return(TRUE);
      582:  447:          case 22: fprintf(file_name,"P85,"); fprintf(stdout, "rsquare.\n");return(TRUE);
      569:  448:          case 23: fprintf(file_name,"P86,"); fprintf(stdout, "quote.\n");return(TRUE);
      558:  449:          case 24: fprintf(file_name,"P87,"); fprintf(stdout, "bquote.\n");return(TRUE);
      537:  450:          case 25: fprintf(file_name,"P88,"); fprintf(stdout, "comma.\n");return(TRUE);
     1496:  451:          case 27: fprintf(file_name,"P89,"); fprintf(stdout, "string,\t");fprintf(stdout, "%s",token_ptr->token_string);
     1496:  452:                   fprintf(stdout, ".\n");return(TRUE);
     1669:  453:          case 29: fprintf(file_name,"P90,"); fprintf(stdout, "character,\t\"");fprintf(stdout, "%s",token_ptr->token_string);
     1669:  454:                   fprintf(stdout, "\".\n");return(TRUE);
    #####:  455:          case 32: fprintf(file_name,"P91,"); fprintf(stdout, "keyword,\t\"=>\".\n");return(TRUE);
    #####:  456:          default: fprintf(file_name,"P92,");break;
        -:  457:      }
    #####:  458:      fprintf(file_name,"P93,");
    #####:  459:      return(FALSE);
        -:  460:}
        -:  461:
    19154:  462:static get_actual_token(token_str,token_ind)
        -:  463:int token_ind;
        -:  464:char token_str[];
        -:  465:{
    19154:  466:    fprintf(file_name,"P94,");
        -:  467:    int ind,start;
    20480:  468:    for(ind=token_ind;ind>0 && isspace(token_str[ind-1]);--ind){
     1326:  469:        fprintf(file_name,"P95,");
        -:  470:    }
    19154:  471:    fprintf(file_name,"P96,");
    19154:  472:    token_str[ind]='\0';token_ind=ind;
    28370:  473:    for(ind=0;ind<token_ind;++ind)
        -:  474:    {
    28334:  475:        fprintf(file_name,"P97,");
    28334:  476:        if(!isspace(token_str[ind]))
        -:  477:        {
    19118:  478:            fprintf(file_name,"P98,");
    19118:  479:            break;
        -:  480:        }
        -:  481:    }
        -:  482:        
        -:  483:                
   109663:  484:    for(start=0;ind<=token_ind;++start,++ind)
        -:  485:    {
    90509:  486:        fprintf(file_name,"P99,");
    90509:  487:        token_str[start]=token_str[ind];
        -:  488:    }
    19154:  489:    fprintf(file_name,"P100,");
    19154:  490:    return;
        -:  491:}
